jQuery(document).ready(function(u){"use strict";if("undefined"!=typeof WPGlobusPlusTinyMCE){if("wpglobus-plus-options"!=WPGlobusPlusTinyMCE.page||"tinymce"!=WPGlobusPlusTinyMCE.tab){if("undefined"==typeof WPGlobusCoreData)return;if("undefined"==typeof WPGlobusAdminApp)return}var a={dLang:WPGlobusCoreData.default_language,languageButtonClass:"widget btn wpglobus-plus-language-button",activeButtonClass:"active",currentLanguage:{},content:{},savedStatus:!1,debugMode:!1,settingsTab:"wpglobus-plus-options"==WPGlobusPlusTinyMCE.page&&"tinymce"==WPGlobusPlusTinyMCE.tab,startInitEditors:!1,submitElements:[],init:function(){a.settingsTab?a.initSettingsTab():(a.debugMode=WPGlobusAdminApp.App.prototype.parseBool(WPGlobusCoreData.page_custom_data.debugMode),"undefined"!=typeof tinymce&&(a.checkSubmitElements(),a.addButtons(),a.initEditors(),a.attachListeners()))},initSettingsTab:function(){u(document).on("click","#wpglobus-plus-add-item",function(t){var e=u("#wpglobus-plus-skeleton tbody tr").clone();u("#wpglobus-plus-tinymce-items tbody .no-items").hide(),u("#wpglobus-plus-tinymce-items tbody").append(e)}),u(document).on("click",".wpglobus-plus-action-ajaxify",function(t){t.preventDefault();t=u(this);"remove"==t.data("action")&&t.parents("tr").fadeToggle("slow"),a.order={},a.order.action=WPGlobusPlusTinyMCE.module+"-"+t.data("action"),a.order.module=WPGlobusPlusTinyMCE.module,a.order.page=t.data("page"),a.order.key=t.data("key"),a.order.settings=WPGlobusPlusTinyMCE.settings,a.ajax(a.order).done(function(t){}).fail(function(t){}).always(function(t,e){})}),u(document).on("change",".wpglobus-plus-ajaxify",function(t){var e=u(this),n=e.parents("tr");a.order={},a.order.action=WPGlobusPlusTinyMCE.module+"-"+e.data("action"),a.order.module=WPGlobusPlusTinyMCE.module,a.order.page=n.find("input.page").val(),a.order.element=n.find("input.element").val(),a.order.key=e.data("key"),a.order.settings=WPGlobusPlusTinyMCE.settings,""!=a.order.page&&""!=a.order.element&&a.ajax(a.order).done(function(t){}).fail(function(t){}).always(function(t,e){})})},ajax:function(t,e){return u.ajax({beforeSend:function(){void 0!==e&&e()},type:"POST",url:ajaxurl,data:{action:WPGlobusPlusTinyMCE.process_ajax,order:t},dataType:"json"})},initEditors:function(){a.startInitEditors&&u(document).on("tinymce-editor-init",function(t,e){a.isExcluded(e.id)||(e.on("nodechange keyup",_.debounce(a.update,300)),u("#"+e.id).on("input keyup",_.debounce(a.update,300)))})},checkSubmitElements:function(){var n=null;void 0!==WPGlobusCoreData.page_custom_data.submitElements[WPGlobusPlusTinyMCE.pagenow]?n=WPGlobusCoreData.page_custom_data.submitElements[WPGlobusPlusTinyMCE.pagenow]:void 0!==WPGlobusCoreData.page_custom_data.submitElements[WPGlobusPlusTinyMCE.page]&&(n=WPGlobusCoreData.page_custom_data.submitElements[WPGlobusPlusTinyMCE.page]),null===n||(u.each(n,function(t,e){/^[#]|^[.]|^input\[name=/.test(e)||(n[t]='input[name="'+e+'"]'),0<u(n[t]).length&&(a.startInitEditors=!0)}),a.submitElements=n)},addButtons:function(){tinymce.PluginManager.add("wpglobus_globe",function(t,e){var n,o;a.isExcluded(t.id)||(a.startInitEditors&&(a.content[t.id]=u("#"+t.id).val(),a.currentLanguage[t.id]=a.dLang,o=WPGlobusCore.getTranslations(a.content[t.id]),u("#"+t.id).val(o[a.dLang]),_.delay(function(){u(t.iframeElement).addClass("wpglobus-translatable").css({width:"99%"}),u("#"+t.id).addClass("wpglobus-translatable")},2e3)),o=a.startInitEditors?(n=a.debugMode?"Get editor ID":"","wpglobus-plus-globe"):(n=WPGlobusPlusTinyMCE.i18n.warning,"wpglobus-plus-red-globe"),t.addButton("wpglobus_globe",{text:"",icon:o,tooltip:n,onclick:function(){"wpglobus-plus-red-globe"==u(this)[0].settings.icon?window.open(WPGlobusPlusTinyMCE.settings.page,"_blank"):a.debugMode&&a.startInitEditors&&t.insertContent(t.id)}}))}),a.startInitEditors&&u.each(WPGlobusCoreData.enabled_languages,function(t,o){tinymce.PluginManager.add("wpglobus_language_button_"+o,function(t,e){var n;a.isExcluded(t.id)||(n=o==a.dLang?a.activeButtonClass:"",t.addButton("wpglobus_language_button_"+o,{text:o,icon:!1,tooltip:"Select "+WPGlobusCoreData.en_language_name[o]+" language",classes:a.languageButtonClass+" "+n+" wpglobus-plus-language-button-"+t.id+" wpglobus-plus-language-button-"+o,onclick:function(){t.execCommand("mceNewDocument"),t.execCommand("mceInsertContent",!1,WPGlobusCore.getTranslations(a.content[t.id])[o]),a.currentLanguage[t.id]=o,a.toggleButtonClass(t.id,o)}}))})})},toggleButtonClass:function(t,e){u(".mce-wpglobus-plus-language-button-"+t).removeClass("mce-active"),u(".mce-wpglobus-plus-language-button-"+t+".mce-wpglobus-plus-language-button-"+e).addClass("mce-active")},attachListeners:function(){a.startInitEditors&&u.each(a.submitElements,function(t,e){return 0==e.length||void u(document).on("mouseenter",e,function(t){u.each(a.content,function(t,e){null==tinymce.get(t)||tinymce.get(t).isHidden()?(u("#"+t).val(e),u("#"+t+"-tmce").click()):tinymce.get(t).setContent(e,{format:"raw"})})}).on("mouseleave",e,function(t){a.savedStatus||u.each(a.content,function(t,e){e=WPGlobusCore.getTranslations(a.content[t])[a.currentLanguage[t]];null==tinymce.get(t)||tinymce.get(t).isHidden()?u("#"+t).val(e):tinymce.get(t).setContent(e,{format:"raw"})})}).on("click",e,function(t){a.savedStatus=!0})})},update:function(t){var e;void 0!==t.target&&("tinymce"==(e=t.target.id)&&(e=t.target.dataset.id),void 0!==a.content[e]&&(t=null==tinymce.get(e)||tinymce.get(e).isHidden()?u("#"+e).val():tinymce.get(e).getContent({format:"raw"}),a.content[e]=WPGlobusCore.getString(a.content[e],t,a.currentLanguage[e])))},isExcluded:function(n){if(void 0===n)return!1;if(-1!=u.inArray(n,WPGlobusPlusTinyMCE.excluded))return!0;var o=!1;return u.each(WPGlobusPlusTinyMCE.excludedMask,function(t,e){if(-1!=n.indexOf(e))return!(o=!0)}),o}};WPGlobusPlusTinyMCE=u.extend({},WPGlobusPlusTinyMCE,a),WPGlobusPlusTinyMCE.init()}});